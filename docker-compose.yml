services:
  gizmatron:
    #image: gizmatron:latest
    build: 
      context: .
      dockerfile: Dockerfile
    image: gizmatron:latest
    container_name: gizmatron
    ports:
      - "8080:8080"
    volumes:
      - "/dev/video0:/dev/video0"
      - "/dev/gpiomem:/dev/gpiomem"
    devices:
      - "/dev/i2c-1:/dev/i2c-1"    
    privileged: true
    restart: unless-stopped
    # sudo docker run -d --privileged --device /dev/i2c-1 --device /dev/video0:/dev/video0 -p 8080:8080 gizmatron:latest

  # GitHub Actions Self-Hosted Runner
  github-runner:
    image: myoung34/github-runner:latest
    container_name: gizmatron-runner
    environment:
      - RUNNER_NAME=gizmatron-pi
      - RUNNER_WORKDIR=/tmp/runner
      - RUNNER_SCOPE=repo
      - REPO_URL=https://github.com/arabenjamin/gizmatron
      - ACCESS_TOKEN=${GITHUB_RUNNER_TOKEN}
      - LABELS=self-hosted,Linux,ARM64,raspberry-pi
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /tmp/runner:/tmp/runner
    restart: unless-stopped
    privileged: true

  # https://www.twingate.com/docs/deploy-connector-with-docker-compose
  twingate-connector:
    image: twingate/connector:latest
    environment:
      - TWINGATE_NETWORK=<TENANT NAME>
      - TWINGATE_ACCESS_TOKEN=<ACCESS TOKEN>
      - TWINGATE_REFRESH_TOKEN=<REFRESH TOKEN>